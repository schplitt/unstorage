---
icon: ic:round-code
---

# Developing Drivers

This guide explains how to develop a custom driver for `unstorage`, including naming conventions, typing options, and best practices. For a practical example, see the [`deno-kv` driver](https://github.com/unjs/unstorage/blob/main/src/drivers/deno-kv.ts).

## 1. Naming Your Driver and Options

  - **Driver file:** Use a clear, kebab-case name (e.g., `my-custom-driver.ts`).
  - **Options interface:** Name it as `MyCustomOptions` (PascalCase, ends with `Options`).
  - **Driver interface:** Name it as `MyCustomDriver` (PascalCase, ends with `Driver`).
  - **Driver name constant:** Declare a `DRIVER_NAME` constant in your file, and ensure its value is identical to the file name (without extension). This should match the pattern in [`src/drivers`](https://github.com/unjs/unstorage/tree/main/src/drivers) (see e.g. `deno-kv.ts`, `fs.ts`, `redis.ts`).
    - The file name is used to determine how to access the driver's options in the global options types (e.g. `opts["my-custom-driver"]`).


## 2. Typing Driver Options

Define an options interface for your driver. This describes the configuration users can pass when initializing the driver.

```ts
// my-custom-driver.ts
export interface MyCustomOptions {
  path: string;
  ttl?: number;
}
```

## 3. Typing Driver Methods

Define a driver interface with the suffix `Driver`. This interface should have the following properties:

- `getOptions`: Type for options passed to `getItem`.
- `setOptions`: Type for options passed to `setItem`.
- `removeOptions`: Type for options passed to `removeItem`.
- `listOptions`: Type for options passed to `getKeys`.

Example:

```ts
export interface MyCustomDriver {
  getOptions: { raw?: boolean };
  setOptions: { foo?: string };
  removeOptions: {};
  listOptions: { prefix?: string };
}
```

## 4. Implementing the Driver

Use the `defineDriver` helper, passing your options and driver types:

```ts
import { defineDriver } from "unstorage";
import type {
  GetOptions,
  SetOptions,
  RemoveOptions,
  ListOptions,
} from "../types";

const DRIVER_NAME = "my-driver";

export default defineDriver<MyCustomOptions, MyCustomDriverInstance>(
  (options) => {
    return {
      name: "my-custom-driver",
      async getItem(key, opts: GetOptions) {

        /** Implementation */
      },
      async setItem(key, value, opts: SetOptions) {
        /** Implementation */
      },
      async removeItem(key, opts: RemoveOptions) {
        /** Implementation */
      },
      async getKeys(base, opts: ListOptions) {
        /** Implementation */
      },
      // ...other methods...
    };
  }
);
```

Take a look at the [deno driver](https://github.com/unjs/unstorage/blob/main/src/drivers/deno-kv.ts) for a complete implementation example with typed options.

## 5. Generating and Using Types Globally

After defining your driver and its types:

1. **Run the code generation script:**

   ```sh
   pnpm gen-drivers
   ```

   This will update the generated types so your driver's options are available inside the `GetOptions`, `SetOptions`, `RemoveOptions`, and `ListOptions` types.

2. **Use the generated types** in your code:

    ```ts
    import type { SetOptions } from 'unstorage';

  defineDriver((options) => {
      return {
          async setItem(key, value, opts: SetOptions) {
            // Get the raw option
            const raw = opts?.["my-driver"]?.raw;
            // opts is typed for your driver
          }
      };
  })
    ```

Some important notes:

- Always use the `Driver` and `Options` suffixes for your types.
- Document your options and method behaviors.
- Document if your driver supports the [common options](https://github.com/unjs/unstorage/blob/src/types.ts#L27)
